<html>
	<head>
		<title>Editor</title>
		<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
		<script src="/editor/codemirror-compressed.js"></script>
		<link rel="stylesheet" href="/editor/codemirror.css"></link>
		<script language="javascript">
			var cm;
			function submit() {
				cm.save()
				$.ajax({
					type: "POST",
					url: "/editor/put",
					data: {contents: JSON.stringify($("#edit").val())},
					dataType: "text",
				}).done(function(data) {
					$("#iframe")[0].src = "/handler";
				});
			}
			$(document).ready(function() {
				$.ajax({
					url: "/editor/get",
					data: {taskName: "handler", fileName: "handler.js"},
					dataType: "text",
				}).done(function(data) {
					if (cm) {
						cm.setValue(data);
					} else {
						$("#edit").val(data);
					}
				});
				var editor = document.getElementById("edit");
				cm = CodeMirror.fromTextArea(editor);
			});
		</script>
	</head>
	<body>
		<h1>Editor</h1>
		<input type="button" value="Update =>" onclick="submit()" style="clear: both"></input>
		<div>
			<textarea id="edit" style="width: 100%; height: 10em"></textarea>
			<iframe id="iframe" style="width: 100%; height: 10em" src="/handler"></iframe>
		</div>
	</body>
</html>
